{"ast":null,"code":"'use strict';\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nvar getId = require('../getId');\n\nvar prefix = 'sessionAccessId-';\n\nfunction createId() {\n  return prefix + Date.now();\n}\n\nmodule.exports = function storageGuest(source, parent) {\n  parent = parent || document.body;\n  var contentWindow = void 0;\n  var callbacks = {};\n  var sessionRequests = [];\n  var connected = false;\n  var closed = true;\n  var connectedTimeout = void 0;\n  var isLoaded = false;\n  var iframe = document.createElement('iframe');\n  iframe.src = source;\n  iframe.width = 0;\n  iframe.height = 0;\n  iframe.style.display = 'none';\n\n  iframe.onload = function () {\n    isLoaded = true;\n  };\n\n  function openStorage() {\n    parent.appendChild(iframe);\n    contentWindow = iframe.contentWindow;\n    closed = false;\n    window.addEventListener('message', handleMessage);\n    checkConnected();\n  }\n\n  openStorage();\n\n  function handleMessage(event) {\n    var response = event.data;\n    var sessionAccessId = getId(response);\n\n    if (sessionAccessId === 'sessionAccessId-connected') {\n      connected = true;\n      return;\n    }\n\n    if (response.connectError) {\n      Object.keys(callbacks).forEach(function (key) {\n        return callbacks[key](response.error);\n      });\n      callbacks = {};\n      return;\n    }\n\n    var callback = callbacks[sessionAccessId];\n\n    if (sessionAccessId && callback) {\n      callback(response.error, response.data);\n    }\n  }\n\n  function close() {\n    clearTimeout(connectedTimeout);\n    window.removeEventListener('message', handleMessage);\n    iframe.parentNode.removeChild(iframe);\n    connected = false;\n    closed = true;\n  }\n\n  function message(method, key, value, callback) {\n    if (closed) {\n      openStorage();\n    }\n\n    if (!connected && method !== 'connect') {\n      sessionRequests.push([method, key, value, callback]);\n    }\n\n    var id = createId();\n\n    if (callbacks && typeof callback === 'function') {\n      callbacks[id] = callback;\n    }\n\n    if (isLoaded) {\n      contentWindow.postMessage({\n        method: method,\n        key: key,\n        value: value,\n        id: id\n      }, source);\n    }\n  }\n\n  function get(key, callback) {\n    if (!callback) {\n      throw new Error('callback required for get');\n    }\n\n    message('get', key, null, callback);\n  }\n\n  function set(key, value, callback) {\n    message('set', key, value, callback);\n  }\n\n  function remove(key, callback) {\n    message('remove', key, null, callback);\n  }\n\n  function checkConnected() {\n    if (connected) {\n      clearTimeout(connectedTimeout);\n\n      while (sessionRequests.length) {\n        message.apply(undefined, _toConsumableArray(sessionRequests.pop()));\n      }\n\n      return;\n    }\n\n    message('connect');\n    connectedTimeout = setTimeout(checkConnected, 125);\n  }\n\n  return {\n    get: get,\n    set: set,\n    remove: remove,\n    close: close\n  };\n};","map":{"version":3,"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","getId","require","prefix","createId","Date","now","module","exports","storageGuest","source","parent","document","body","contentWindow","callbacks","sessionRequests","connected","closed","connectedTimeout","isLoaded","iframe","createElement","src","width","height","style","display","onload","openStorage","appendChild","window","addEventListener","handleMessage","checkConnected","event","response","data","sessionAccessId","connectError","Object","keys","forEach","key","error","callback","close","clearTimeout","removeEventListener","parentNode","removeChild","message","method","value","push","id","postMessage","get","Error","set","remove","apply","undefined","pop","setTimeout"],"sources":["C:/Users/abronshtein/Desktop/Code/STU/Polls/client_/node_modules/cross-domain-storage/distribution/guest/index.js"],"sourcesContent":["'use strict';\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar getId = require('../getId');\n\nvar prefix = 'sessionAccessId-';\n\nfunction createId() {\n    return prefix + Date.now();\n}\n\nmodule.exports = function storageGuest(source, parent) {\n    parent = parent || document.body;\n\n    var contentWindow = void 0;\n    var callbacks = {};\n    var sessionRequests = [];\n    var connected = false;\n    var closed = true;\n    var connectedTimeout = void 0;\n    var isLoaded = false;\n\n    var iframe = document.createElement('iframe');\n    iframe.src = source;\n    iframe.width = 0;\n    iframe.height = 0;\n    iframe.style.display = 'none';\n    iframe.onload = function () {\n        isLoaded = true;\n    };\n\n    function openStorage() {\n        parent.appendChild(iframe);\n        contentWindow = iframe.contentWindow;\n        closed = false;\n\n        window.addEventListener('message', handleMessage);\n\n        checkConnected();\n    }\n\n    openStorage();\n\n    function handleMessage(event) {\n        var response = event.data;\n        var sessionAccessId = getId(response);\n\n        if (sessionAccessId === 'sessionAccessId-connected') {\n            connected = true;\n            return;\n        }\n\n        if (response.connectError) {\n            Object.keys(callbacks).forEach(function (key) {\n                return callbacks[key](response.error);\n            });\n            callbacks = {};\n            return;\n        }\n\n        var callback = callbacks[sessionAccessId];\n\n        if (sessionAccessId && callback) {\n            callback(response.error, response.data);\n        }\n    }\n\n    function close() {\n        clearTimeout(connectedTimeout);\n        window.removeEventListener('message', handleMessage);\n        iframe.parentNode.removeChild(iframe);\n        connected = false;\n        closed = true;\n    }\n\n    function message(method, key, value, callback) {\n        if (closed) {\n            openStorage();\n        }\n\n        if (!connected && method !== 'connect') {\n            sessionRequests.push([method, key, value, callback]);\n        }\n\n        var id = createId();\n\n        if (callbacks && typeof callback === 'function') {\n            callbacks[id] = callback;\n        }\n\n        if (isLoaded) {\n            contentWindow.postMessage({\n                method: method,\n                key: key,\n                value: value,\n                id: id\n            }, source);\n        }\n    }\n\n    function get(key, callback) {\n        if (!callback) {\n            throw new Error('callback required for get');\n        }\n\n        message('get', key, null, callback);\n    }\n\n    function set(key, value, callback) {\n        message('set', key, value, callback);\n    }\n\n    function remove(key, callback) {\n        message('remove', key, null, callback);\n    }\n\n    function checkConnected() {\n        if (connected) {\n            clearTimeout(connectedTimeout);\n            while (sessionRequests.length) {\n                message.apply(undefined, _toConsumableArray(sessionRequests.pop()));\n            }\n\n            return;\n        }\n\n        message('connect');\n\n        connectedTimeout = setTimeout(checkConnected, 125);\n    }\n\n    return {\n        get: get,\n        set: set,\n        remove: remove,\n        close: close\n    };\n};"],"mappings":"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"},"metadata":{},"sourceType":"script"}